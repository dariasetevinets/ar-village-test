<!-- /postcard_1/index_postcard1.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>AR-открытка · A5 + AR.js · postcard_1</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />

  <!-- A-Frame + AR.js (зафиксируйте версии под прод) -->
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <style>html,body{margin:0;height:100%;overflow:hidden;background:#000}</style>

  <script>
    // Файлы проекта
    const DRAWING_URL = "https://dariasetevinets.github.io/ar-village-test/assets/drawings/setevinets_index-1.png"; // AR-изображение
    const PATT_URL    = "https://dariasetevinets.github.io/ar-village-test/assets/patterns/sdxtp-1.patt";          // Маркер на печатной открытке

    // Геометрия открытки 1 (без калибровки, жёстко):
    // A5 по горизонтали: 210×148 мм; маркер 50 мм.
    // Центр маркера отстоит от правого и нижнего краёв на 35 мм.
    const CARD_W = 210, CARD_H = 148;    // мм
    const MARKER_MM = 50;                // мм (черный квадрат)
    const DX_RIGHT = 35, DY_BOTTOM = 35; // мм

    // mm-align: позиционирование и поворот в системе маркера, вход — мм
    AFRAME.registerComponent('mm-align', {
      schema: { w:{type:'number'}, h:{type:'number'}, x:{type:'number'}, y:{type:'number'}, z:{type:'number',default:1}, rotZ:{type:'number',default:90} },
      update(){
        const mm=0.001, d=this.data;
        this.el.setAttribute('geometry', {primitive:'plane', width:d.w*mm, height:d.h*mm});
        this.el.setAttribute('position', `${d.x*mm} ${d.y*mm} ${d.z*mm}`);
        this.el.setAttribute('rotation', `0 0 ${d.rotZ}`); // почему: «верх» PNG должен идти вдоль +X
      }
    });
  </script>
</head>
<body>
  <a-scene vr-mode-ui="enabled:false" embedded arjs="sourceType: webcam; debugUIEnabled:false;"
           renderer="logarithmicDepthBuffer:true; antialias:true">

    <a-assets timeout="20000">
      <img id="drawing" crossorigin="anonymous" src="https://dariasetevinets.github.io/ar-village-test/assets/drawings/setevinets_index-1.png">
    </a-assets>

    <!-- ВАЖНО: size = физический размер черного квадрата маркера (в метрах) -->
    <a-marker type="pattern" patternUrl="https://dariasetevinets.github.io/ar-village-test/assets/patterns/sdxtp-1.patt" size="0.05" emitevents="true">
      <a-entity id="arPlane"
                material="src:#drawing; transparent:true; alphaTest:0; opacity:1; side:double; shader:flat"
                mm-align="w:210; h:148; x:-70; y:39; z:1; rotZ:90">
      </a-entity>
    </a-marker>

    <a-entity camera></a-entity>
  </a-scene>

  <script>
    // Вычисление смещений (оставлено как справка):
    // x = DX_RIGHT - CARD_W/2 = 35 - 105 = -70 мм
    // y = CARD_H/2 - DY_BOTTOM = 74 - 35 = 39 мм
    // Z используется только как «поднятие» над плоскостью открытки.
  </script>
</body>
</html>
