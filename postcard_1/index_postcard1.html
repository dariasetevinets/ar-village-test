<!-- /postcard_1/index_postcard1.html -->
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Postcard 1 · A5 · marker bottom-right · UPRIGHT</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <style>body{margin:0;overflow:hidden}</style>
  <script>
    // Подставь свои пути при необходимости:
    const DRAWING_URL = "https://dariasetevinets.github.io/ar-village-test/assets/drawings/setevinets_index-1.png";
    const PATT_URL    = "https://dariasetevinets.github.io/ar-village-test/assets/patterns/sdxtp-1.patt";

    // mm-align: размеры/позиция в МИЛЛИМЕТРАХ от центра маркера (правый нижний угол открытки).
    // orientation:
    //  - 'upright' — открытка держится перед камерой (параллельно ей)
    //  - 'flat'    — открытка лежит на столе
    AFRAME.registerComponent('mm-align',{
      schema:{
        w:{type:'number',default:160}, h:{type:'number',default:130},
        x:{type:'number',default:-175}, y:{type:'number',default:35},
        z:{type:'number',default:1},
        orientation:{type:'string',default:'upright'} // << ключевой параметр
      },
      init(){ this._apply=this._apply.bind(this); this.el.addEventListener('loaded',this._apply); },
      remove(){ this.el.removeEventListener('loaded',this._apply); },
      update(){ this._apply(); },
      _apply(){
        const mm=0.001, p=this.data;
        // ширина/высота (для plane/image)
        if(this.el.getAttribute('width')!==null){ this.el.setAttribute('width', p.w*mm); }
        if(this.el.getAttribute('height')!==null){ this.el.setAttribute('height', p.h*mm); }
        // позиция
        this.el.setAttribute('position', `${p.x*mm} ${p.y*mm} ${p.z*mm}`);
        // ориентация плоскости
        const rot = (p.orientation === 'flat') ? '-90 0 0' : '0 0 0';
        this.el.setAttribute('rotation', rot);
      }
    });

    window.addEventListener('load',()=>{
      document.getElementById('drawing1').setAttribute('src', DRAWING_URL);
      document.getElementById('marker').setAttribute('url', PATT_URL);
    });
  </script>
</head>
<body>
  <a-scene vr-mode-ui="enabled:false" embedded
           arjs="sourceType: webcam; debugUIEnabled:false;"
           renderer="logarithmicDepthBuffer:true;">
    <a-assets timeout="20000">
      <img id="drawing1" crossorigin="anonymous">
    </a-assets>

    <!-- size ДОЛЖЕН совпадать с реальным печатным размером маркера (0.05 = 50 мм) -->
    <a-marker id="marker" type="pattern" size="0.05" emitevents="true">

      <!-- Сам AR-рисунок: используем plane с текстурой -->
      <a-plane id="ar-plane"
               material="src:#drawing1; transparent:true; alphaTest:0; opacity:1; side:double; shader:flat"
               mm-align="w:160; h:130; x:-175; y:35; z:1; orientation: upright">
      </a-plane>

      <!-- (опционально) Контур A5 для проверки геометрии, можно скрыть/удалить -->
      <a-plane position="-0.105 0.074 0.0005"
               width="0.21" height="0.148"
               rotation="0 0 0"        <!-- открытка держится вертикально → без -90 -->
               material="color:#00ffff; opacity:0.08; side:double">
      </a-plane>
    </a-marker>

    <a-entity camera></a-entity>
  </a-scene>
</body>
</html>



