<!-- /postcard_1/index_postcard1.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>AR‑открытка · A5 + AR.js · postcard_1</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />

  <!-- Минимальный и стабильный стек -->
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.js"></script>
  <style>html,body{margin:0;height:100%;overflow:hidden;background:#000}</style>
</head>
<body>
  <!-- Никаких оверлеев/кнопок — чистый запуск камеры -->
  <a-scene embedded vr-mode-ui="enabled:false"
           renderer="antialias:true; logarithmicDepthBuffer:true"
           arjs="sourceType: webcam; facingMode: environment; videoTexture: true; trackingMethod: best; debugUIEnabled:false;">

    <a-assets timeout="20000">
      <img id="drawing" crossorigin="anonymous"
           src="https://dariasetevinets.github.io/ar-village-test/assets/drawings/setevinets_index-1.png">
    </a-assets>

    <!-- Маркер: .patt из печати. size = физический размер чёрного квадрата (метры) -->
    <a-marker type="pattern"
              patternUrl="https://dariasetevinets.github.io/ar-village-test/assets/patterns/sdxtp-1.patt"
              size="0.05">

      <!-- AR‑плоскость: A5 (210×148 мм). Верх изображения вдоль +X (rotZ=90).  -->
      <!-- Смещения от центра маркера: x = -70 мм, y = 39 мм → в метрах: -0.07 и 0.039.  -->
      <a-entity id="arPlane"
                geometry="primitive: plane; width: 0.21; height: 0.148"
                material="src:#drawing; transparent:true; side:double; shader:flat"
                position="-0.07 0.039 0.001"
                rotation="0 0 90">
      </a-entity>
          <!-- Малиновая маска A5 для проверки совмещения (под AR-изображением) -->
      <a-entity id="a5MaskFill"
                geometry="primitive: plane; width: 0.21; height: 0.148"
                position="-0.07 0.039 0.0005"
                material="color:#e30b5c; opacity:0.12; side:double"></a-entity>
      <a-entity id="a5MaskOutline"
                geometry="primitive: plane; width: 0.21; height: 0.148"
                position="-0.07 0.039 0.00049"
                material="color:#e30b5c; opacity:0.8; wireframe:true; side:double"></a-entity>
    </a-marker>

    <a-entity camera></a-entity>
  </a-scene>

<script>
  // Надёжный автозапуск видео без кнопок и оверлеев
  (function(){
    function ensurePlay(){
      const v = document.querySelector('video');
      if(!v) return;
      try{
        v.setAttribute('playsinline','');
        v.setAttribute('webkit-playsinline','');
        v.muted = true; // почему: авто‑воспроизведение на мобильных только без звука
        v.autoplay = true;
        const p = v.play(); if(p && p.catch) p.catch(()=>{});
      }catch(_){/* no-op */}
    }
    const scene = document.querySelector('a-scene');
    scene.addEventListener('camera-init', ensurePlay);
    scene.addEventListener('arjs-video-loaded', ensurePlay);
    scene.addEventListener('camera-error', e=>console.warn('[AR] camera-error', e));
    // Несколько попыток автозапуска на старте (для iOS/встроенных браузеров)
    let tries = 0; const t = setInterval(()=>{ ensurePlay(); if(++tries>10) clearInterval(t); }, 400);
    // Любое касание/клик также триггерит запуск (без UI)
    const once = ()=>{ ensurePlay(); document.removeEventListener('touchend', once); document.removeEventListener('click', once); };
    document.addEventListener('touchend', once, {passive:true});
    document.addEventListener('click', once);
  })();
</script>
</body>
</html>





