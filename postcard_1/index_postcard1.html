<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Postcard 1 — A5 WebAR (marker bottom-right)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <style>
    .hud { position: fixed; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,.6); color: #fff; padding: 8px 12px; font: 14px/1.4 system-ui, sans-serif; }
    .hud small { opacity: .8; }
  </style>
  <script>
    // Выравнивание в миллиметрах от центра маркера (правый нижний угол открытки)
    // Используй атрибут: mm-align="w:90; h:140; x:-90; y:5; z:1"
    AFRAME.registerComponent('mm-align', {
      schema: {
        w: { type: 'number', default: 90 },   // ширина картинки в мм
        h: { type: 'number', default: 140 },  // высота картинки в мм
        x: { type: 'number', default: -90 },  // смещение по X от центра маркера в мм (влево отрицательное)
        y: { type: 'number', default: 5 },    // смещение по Y от центра маркера в мм (вверх положительное)
        z: { type: 'number', default: 1 }     // приподнять над плоскостью в мм
      },
      update: function () {
        const m = this.data;
        const w = (m.w || 0) / 1000;  // м
        const h = (m.h || 0) / 1000;
        const x = (m.x || 0) / 1000;
        const y = (m.y || 0) / 1000;
        const z = (m.z || 0) / 1000;
        // ставим размер и позицию
        this.el.setAttribute('width', w);
        this.el.setAttribute('height', h);
        this.el.setAttribute('position', { x: x, y: y, z: z });
        // плоскость для картинки (в плоскости открытки)
        this.el.setAttribute('rotation', '-90 0 0');
      }
    });
  </script>
</head>
<body style="margin:0; overflow:hidden;">
  <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;" renderer="logarithmicDepthBuffer: true;">
    <a-assets>
      <!-- AR изображение -->
      <img id="drawing1" src="Открытка 1/setevinets_index-1.png" crossorigin="anonymous">
    </a-assets>

    <!-- Маркер: sdxtp-1.patt. В печати его размер 50x50 мм => size=0.05 -->
    <a-marker type="pattern" url="Открытка 1/sdxtp-1.patt" size="0.05" emitevents="true">
      <!-- Плоскость A5 для отладки (210x148 мм), якорь — правый нижний угол (центр маркера) -->
      <a-plane width="0.21" height="0.148" position="-0.105 0.074 0.0005" rotation="-90 0 0" color="#00ffff" opacity="0.15"></a-plane>
      <!-- Визуализация самого маркера 50x50 мм -->
      <a-plane width="0.05" height="0.05" position="0 0 0.0003" rotation="-90 0 0" color="#ff00ff" opacity="0.25"></a-plane>

      <!-- Само AR изображение: управляй миллиметрами через mm-align -->
      <a-image
        src="#drawing1"
        material="transparent: true; alphaTest: 0.03;"
        mm-align="w: 90; h: 140; x: -90; y: 5; z: 1">
      </a-image>
    </a-marker>

    <a-entity camera></a-entity>
  </a-scene>

  <div class="hud">
    <div><b>Postcard 1</b>: маркер в правом нижнем углу, <small>A5 = 210×148 мм</small></div>
    <div><small>Редактируй атрибут <code>mm-align</code>: <code>w/h</code> — размер PNG, <code>x/y</code> — позиция от центра маркера в мм.</small></div>
  </div>
</body>
</html>
