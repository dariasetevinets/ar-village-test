<!-- /postcard_1/index_postcard1.html -->
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Postcard 1 · A5 · marker bottom-right (upright)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <style>body{margin:0;overflow:hidden}</style>

  <script>
    // Пути к ресурсам (замени при необходимости)
    const DRAWING_URL = "https://dariasetevinets.github.io/ar-village-test/assets/drawings/setevinets_index-1.png";
    const PATT_URL    = "https://dariasetevinets.github.io/ar-village-test/assets/patterns/sdxtp-1.patt";

    // mm-align: локальные координаты ОТ ЦЕНТРА МАРКЕРА (мм), управление GEOMETRY (в метрах)
    AFRAME.registerComponent('mm-align', {
      schema: {
        w:{type:'number',default:160},  // мм — ширина рисунка
        h:{type:'number',default:130},  // мм — высота рисунка
        x:{type:'number',default:-175}, // мм — влево(−)/вправо(+)
        y:{type:'number',default:35},   // мм — вверх(+)/вниз(−)
        z:{type:'number',default:1},    // мм — к камере
        orientation:{type:'string',default:'flat'},
        rotZ:{type:'number',default:90} // поворот в плоскости (градусы), чтобы «верх» шёл вдоль X
      },
      init(){ this._apply=this._apply.bind(this); this.el.addEventListener('loaded',this._apply); },
      remove(){ this.el.removeEventListener('loaded',this._apply); },
      update(){ this._apply(); },
      _apply(){
        const mm=1, d=this.data;
        const W = d.w*mm, H = d.h*mm;
        // Важно: обновлять geometry (а не width/height атрибуты)
        this.el.setAttribute('geometry', {primitive:'plane', width: W, height: H});
        this.el.setAttribute('position', `${d.x*mm} ${d.y*mm} ${d.z*mm}`);
        const base = (d.orientation==='flat') ? [0,0,90] : [0,0,0];
        base[2] += d.rotZ;
        this.el.setAttribute('rotation', base.join(' '));
      }
    });
  </script>
</head>
<body>
  <a-scene vr-mode-ui="enabled:false" embedded
           arjs="sourceType: webcam; debugUIEnabled:false;"
           renderer="logarithmicDepthBuffer:true;">
    <a-assets timeout="20000">
      <img id="drawing1" crossorigin="anonymous" src="">
    </a-assets>

    <!-- size ДОЛЖЕН совпадать с реальным печатным размером маркера (0.05 = 50 мм) -->
    <a-marker id="marker" type="pattern" size="1" emitevents="true" url="">
      <!-- (опционально) A5-подложка для визуальной проверки — можно убрать -->
      <a-plane position="-0.105 0.074 90"
               width="0.21" height="0.148"
               rotation="0 0 0"
               material="color:#00ffff; opacity:0.08; side:double"></a-plane>

      <!-- AR-рисунок: плоскость с текстурой PNG -->
      <a-plane id="ar-plane"
               material="src:#drawing1; transparent:true; alphaTest:0; opacity:1; side:double; shader:flat"
               mm-align="w:160; h:130; x:-175; y:35; z:1; orientation:flat; rotZ:90">
      </a-plane>
    </a-marker>

    <a-entity camera></a-entity>
  </a-scene>

  <script>
    // Подставляем ресурсы
    document.getElementById('drawing1').setAttribute('src', DRAWING_URL);
    document.getElementById('marker').setAttribute('url', PATT_URL);
  </script>
</body>
</html>






